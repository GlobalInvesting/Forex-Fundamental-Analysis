name: Update Interest Rates
on:
  schedule:
    - cron: '0 8 * * *'  # Todos los dÃ­as a las 8:00 AM UTC
  workflow_dispatch:

jobs:
  update-rates:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Create rates directory
        run: mkdir -p rates
      
      # USD - Federal Funds Rate
      - name: Fetch USD rate
        run: |
          curl -s "https://api.stlouisfed.org/fred/series/observations?series_id=FEDFUNDS&api_key=5e0ae2ba29361b8ddb614fd5f92c0a51&file_type=json&limit=1&sort_order=desc" > rates/USD.json || echo '{"observations":[{"value":"4.50","date":"2026-02-12"}]}' > rates/USD.json
      
      # EUR - ECB Main Refinancing Rate
      - name: Fetch EUR rate
        run: |
          curl -s "https://api.stlouisfed.org/fred/series/observations?series_id=ECBMRRFR&api_key=5e0ae2ba29361b8ddb614fd5f92c0a51&file_type=json&limit=1&sort_order=desc" > rates/EUR.json || echo '{"observations":[{"value":"3.00","date":"2026-02-12"}]}' > rates/EUR.json
      
      # GBP - Bank of England Official Rate
      - name: Fetch GBP rate
        run: |
          curl -s "https://api.stlouisfed.org/fred/series/observations?series_id=BOERUKM&api_key=5e0ae2ba29361b8ddb614fd5f92c0a51&file_type=json&limit=1&sort_order=desc" > rates/GBP.json || echo '{"observations":[{"value":"4.75","date":"2026-02-12"}]}' > rates/GBP.json
      
      # JPY - Bank of Japan Policy Rate
      - name: Fetch JPY rate
        run: |
          curl -s "https://api.stlouisfed.org/fred/series/observations?series_id=INTDSRJPM193N&api_key=5e0ae2ba29361b8ddb614fd5f92c0a51&file_type=json&limit=1&sort_order=desc" > rates/JPY.json || echo '{"observations":[{"value":"0.50","date":"2026-02-12"}]}' > rates/JPY.json
      
      # AUD - RBA Cash Rate
      - name: Fetch AUD rate
        run: |
          curl -s "https://api.stlouisfed.org/fred/series/observations?series_id=RBATCTR&api_key=5e0ae2ba29361b8ddb614fd5f92c0a51&file_type=json&limit=1&sort_order=desc" > rates/AUD.json || echo '{"observations":[{"value":"4.35","date":"2026-02-12"}]}' > rates/AUD.json
      
      # CAD - Bank of Canada Overnight Rate
      - name: Fetch CAD rate
        run: |
          curl -s "https://api.stlouisfed.org/fred/series/observations?series_id=INTDSRCAM193N&api_key=5e0ae2ba29361b8ddb614fd5f92c0a51&file_type=json&limit=1&sort_order=desc" > rates/CAD.json || echo '{"observations":[{"value":"3.25","date":"2026-02-12"}]}' > rates/CAD.json
      
      # CHF - SNB Policy Rate
      - name: Fetch CHF rate
        run: |
          curl -s "https://api.stlouisfed.org/fred/series/observations?series_id=CHESNBPOLICYRATE&api_key=5e0ae2ba29361b8ddb614fd5f92c0a51&file_type=json&limit=1&sort_order=desc" > rates/CHF.json || echo '{"observations":[{"value":"0.50","date":"2026-02-12"}]}' > rates/CHF.json
      
      # NZD - RBNZ Official Cash Rate
      - name: Fetch NZD rate
        run: |
          curl -s "https://api.stlouisfed.org/fred/series/observations?series_id=NZOCRS&api_key=5e0ae2ba29361b8ddb614fd5f92c0a51&file_type=json&limit=1&sort_order=desc" > rates/NZD.json || echo '{"observations":[{"value":"4.25","date":"2026-02-12"}]}' > rates/NZD.json
      
      - name: Display fetched rates
        run: |
          echo "=== USD ==="
          cat rates/USD.json | jq '.observations[0]' || cat rates/USD.json
          echo ""
          echo "=== EUR ==="
          cat rates/EUR.json | jq '.observations[0]' || cat rates/EUR.json
          echo ""
          echo "=== GBP ==="
          cat rates/GBP.json | jq '.observations[0]' || cat rates/GBP.json
          echo ""
          echo "=== JPY ==="
          cat rates/JPY.json | jq '.observations[0]' || cat rates/JPY.json
          echo ""
          echo "=== AUD ==="
          cat rates/AUD.json | jq '.observations[0]' || cat rates/AUD.json
          echo ""
          echo "=== CAD ==="
          cat rates/CAD.json | jq '.observations[0]' || cat rates/CAD.json
          echo ""
          echo "=== CHF ==="
          cat rates/CHF.json | jq '.observations[0]' || cat rates/CHF.json
          echo ""
          echo "=== NZD ==="
          cat rates/NZD.json | jq '.observations[0]' || cat rates/NZD.json
      
      - name: Commit and push
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add rates/
          git diff --quiet && git diff --staged --quiet || (git commit -m "Update rates $(date +'%Y-%m-%d %H:%M UTC')" && git push)
